

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Building an Organizations Collaboration Network Diagram &mdash; API Lab - reusable notebooks for research data analytics - powered by Dimensions Analytics API</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/js/custom.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "tex2jax_ignore|mathjax_ignore|document", "processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Collaboration Patterns By Year (International, Domestic, Internal)" href="4-international-collaboration-by-year.html" />
    <link rel="prev" title="Identifying the Industry Collaborators of an Academic Institution" href="2-Industry-Collaboration.html" />
    

   <script async src="https://www.googletagmanager.com/gtag/js?id=UA-149959808-1"></script>
   <!-- <script src="_static/js/custom.js"></script> -->


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> DSL
          

          
            
            <img src="../_static/dimensions-logo@2x.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          

   <p class="">
      <h3 id="cookbooks_title">API COOKBOOKS</h3>
   </p>


   
            
            
              
            
            
              <p class="caption"><span class="caption-text">Folder</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1-GRID-preview.html">The Organizations API: Features Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="1-GRID-preview.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="1-GRID-preview.html#1.-Matching-affiliation-data-to-GRID-IDs-using-extract_affiliations">1. Matching affiliation data to GRID IDs using <code class="docutils literal notranslate"><span class="pre">extract_affiliations</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="1-GRID-preview.html#2.-Searching-GRID-organizations">2. Searching GRID organizations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="1-GRID-preview.html#Full-text-search">Full-text search</a></li>
<li class="toctree-l3"><a class="reference internal" href="1-GRID-preview.html#Fielded-search">Fielded search</a></li>
<li class="toctree-l3"><a class="reference internal" href="1-GRID-preview.html#Returning-facets">Returning facets</a></li>
<li class="toctree-l3"><a class="reference internal" href="1-GRID-preview.html#Returning-organizations-facets-from-publications">Returning organizations facets from publications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="1-GRID-preview.html#3.-A-closer-look-at-the-organizations-data-statistics">3. A closer look at the organizations data statistics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="1-GRID-preview.html#Let’s-visualize-the-data-with-plotly">Let’s visualize the data with plotly</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="1-GRID-preview.html#Where-to-find-out-more">Where to find out more</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="2-Industry-Collaboration.html">Identifying the Industry Collaborators of an Academic Institution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="2-Industry-Collaboration.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Industry-Collaboration.html#1.-Selecting-an-academic-institution">1. Selecting an academic institution</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Industry-Collaboration.html#2.-Extracting-publications-from-industry-collaborations">2. Extracting publications from industry collaborations</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-Industry-Collaboration.html#3.-Analyses">3. Analyses</a><ul>
<li class="toctree-l3"><a class="reference internal" href="2-Industry-Collaboration.html#3.1-Count-of-Publications-per-year-from-Industry-Collaborations">3.1 Count of Publications per year from Industry Collaborations</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Industry-Collaboration.html#3.2-Citations-from-Industry-Collaboration">3.2 Citations from Industry Collaboration</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Industry-Collaboration.html#3.3-Top-Industry-Collaborators">3.3 Top Industry Collaborators</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Industry-Collaboration.html#3.4-Countries-of-Industry-Collaborators">3.4 Countries of Industry Collaborators</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-Industry-Collaboration.html#3.5-Putting-Countries-and-Collaborators-together">3.5 Putting Countries and Collaborators together</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building an Organizations Collaboration Network Diagram</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#1.-Choose-an-Organization-and-a-keyword-(topic)">1. Choose an Organization and a keyword (topic)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#2.-Building-a-one-degree-network-of-collaborating-institutions">2. Building a one-degree network of collaborating institutions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#3.-Building-a-network-of-any-size">3. Building a network of any size</a></li>
<li class="toctree-l2"><a class="reference internal" href="#4.-Visualizing-the-network">4. Visualizing the network</a></li>
<li class="toctree-l2"><a class="reference internal" href="#5.-Addendum:-showing-only-‘Government’-collaborators">5. Addendum: showing only ‘Government’ collaborators</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Conclusions">Conclusions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="4-international-collaboration-by-year.html">Collaboration Patterns By Year (International, Domestic, Internal)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#1.-Lookup-the-University-that-you-are-interested-in">1. Lookup the University that you are interested in</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#2.-Publications-output-by-year">2. Publications output by year</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#3.-International-publications">3. International publications</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#4.-Domestic">4. Domestic</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#5.-Internal">5. Internal</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#6.-Joining-up-All-metrics-together">6. Joining up All metrics together</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#7.-How-does-this-compare-to-Australia?">7. How does this compare to Australia?</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#8.-How-does-this-compare-to-a-different-Institution-(University-of-Toronto)?">8. How does this compare to a different Institution (University of Toronto)?</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-international-collaboration-by-year.html#Want-to-learn-more?">Want to learn more?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html">Mapping GRID IDs to Organization Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html#Prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html#1.-Importing-Organization-Data">1. Importing Organization Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html#1.1-Manually-Generate-Organization-Data">1.1 Manually Generate Organization Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html#1.2-Load-Organization-Data-from-Local-Machine">1.2 Load Organization Data from Local Machine</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html#2.-Utilizing-Dimensions-API-to-Extract-GRID-IDs">2. Utilizing Dimensions API to Extract GRID IDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html#3.-Save-the-GRID-ID-Dataset-we-created">3. Save the GRID ID Dataset we created</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-mapping-grid-ids-to-organization-data.html#Conclusions">Conclusions</a></li>
</ul>
</li>
</ul>

            
          


   <div id="sidebar_github" style="margin-top: 12px;">
   <h3>Github Source</h3>

      <div style="margin: 10px 20px;">
      
         <iframe src="https://ghbtns.com/github-btn.html?user=digital-science&repo=dimensions-api-lab&type=star&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe>

         <iframe src="https://ghbtns.com/github-btn.html?user=digital-science&repo=dimensions-api-lab&type=fork&count=true" frameborder="0" scrolling="0" width="170px" height="20px"></iframe> 
      
      </div>

   </div>


        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DSL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    

    

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<script src='https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js'></script>
<script>require=requirejs;</script><a class="reference external image-reference" href="https://colab.research.google.com/github/digital-science/dimensions-api-lab/blob/master/cookbooks/3-Organizations-Collaboration-Network.ipynb"><img alt="../_images/badge-colab.svg" src="../_images/badge-colab.svg" /></a>
<a class="reference external image-reference" href="https://github.com/digital-science/dimensions-api-lab/blob/master/cookbooks/3-Organizations-Collaboration-Network.ipynb"><img alt="../_images/badge-github-custom.svg" src="../_images/badge-github-custom.svg" /></a>
<hr class="docutils" />
<div class="section" id="Building-an-Organizations-Collaboration-Network-Diagram">
<h1>Building an Organizations Collaboration Network Diagram<a class="headerlink" href="#Building-an-Organizations-Collaboration-Network-Diagram" title="Permalink to this headline">¶</a></h1>
<p>This notebook shows how to analyse organizations collaboration data using the <a class="reference external" href="https://docs.dimensions.ai/dsl/datasource-organizations.html">Organizations data source</a> available via the <a class="reference external" href="https://docs.dimensions.ai/dsl/">Dimensions Analytics API</a>.</p>
<p>Starting from a <strong>research organization</strong>, we will extract information about other organizations that collaborated with it, based on shared publications data.</p>
<p>In order to make the analysis more focused, we are going to select also a <strong>topic</strong> and a <strong>time-frame</strong>. By appying these extra constraints we will reduce the number of shared publications data and also make the overall extraction faster.</p>
<p>At the end of the tutorial we will generate a ‘collaborations network diagram’. The diagram nodes represent the organizations working together, while the edges represent the number of publications they have in common. An example of the resulting network diagram <a class="reference external" href="http://api-sample-data.dimensions.ai/dataviz-exports/3-Organizations-Collaboration-Network/network_2_levels_grid.412125.1.html">can be seen here</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==</span><span class="se">\n</span><span class="s2">CHANGELOG</span><span class="se">\n</span><span class="s2">This notebook was last run on </span><span class="si">%s</span><span class="se">\n</span><span class="s2">==&quot;</span> <span class="o">%</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1">, %Y&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
==
CHANGELOG
This notebook was last run on Jan 25, 2022
==
</pre></div></div>
</div>
<div class="section" id="Prerequisites">
<h2>Prerequisites<a class="headerlink" href="#Prerequisites" title="Permalink to this headline">¶</a></h2>
<p>This notebook assumes you have installed the <a class="reference external" href="https://pypi.org/project/dimcli/">Dimcli</a> library and are familiar with the <a class="reference external" href="https://api-lab.dimensions.ai/cookbooks/1-getting-started/1-Using-the-Dimcli-library-to-query-the-API.html">‘Getting Started’ tutorial</a>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install dimcli plotly tqdm pyvis -U --quiet

<span class="c1">#</span>
<span class="c1"># load libraries</span>
<span class="kn">import</span> <span class="nn">dimcli</span>
<span class="kn">from</span> <span class="nn">dimcli.utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span> <span class="k">as</span> <span class="n">progress</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>  <span class="c1"># plotly&gt;=4.8.1</span>
<span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
  <span class="c1"># make js dependecies local / needed by html exports</span>
  <span class="kn">from</span> <span class="nn">plotly.offline</span> <span class="kn">import</span> <span class="n">init_notebook_mode</span>
  <span class="n">init_notebook_mode</span><span class="p">(</span><span class="n">connected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==</span><span class="se">\n</span><span class="s2">Logging in..&quot;</span><span class="p">)</span>
<span class="c1"># https://digital-science.github.io/dimcli/getting-started.html#authentication</span>
<span class="n">ENDPOINT</span> <span class="o">=</span> <span class="s2">&quot;https://app.dimensions.ai&quot;</span>
<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
  <span class="kn">import</span> <span class="nn">getpass</span>
  <span class="n">KEY</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;API Key: &#39;</span><span class="p">)</span>
  <span class="n">dimcli</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">KEY</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">ENDPOINT</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">KEY</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
  <span class="n">dimcli</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">KEY</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="n">ENDPOINT</span><span class="p">)</span>
<span class="n">dsl</span> <span class="o">=</span> <span class="n">dimcli</span><span class="o">.</span><span class="n">Dsl</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<script type="text/javascript">
window.PlotlyConfig = {MathJaxConfig: 'local'};
if (window.MathJax) {MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
if (typeof require !== 'undefined') {
require.undef("plotly");
requirejs.config({
    paths: {
        'plotly': ['https://cdn.plot.ly/plotly-2.8.3.min']
    }
});
require(['plotly'], function(Plotly) {
    window._Plotly = Plotly;
});
}
</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Searching config file credentials for &#39;https://app.dimensions.ai&#39; endpoint..
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
==
Logging in..
Dimcli - Dimensions API Client (v0.9.6)
Connected to: &lt;https://app.dimensions.ai/api/dsl&gt; - DSL v2.0
Method: dsl.ini file
</pre></div></div>
</div>
</div>
<div class="section" id="1.-Choose-an-Organization-and-a-keyword-(topic)">
<h2>1. Choose an Organization and a keyword (topic)<a class="headerlink" href="#1.-Choose-an-Organization-and-a-keyword-(topic)" title="Permalink to this headline">¶</a></h2>
<p>For the purpose of this exercise, we will use <a class="reference external" href="https://grid.ac/institutes/grid.412125.1">grid.412125.1</a> (King Abdulaziz University, Saudi Arabia).</p>
<blockquote>
<div><p>You can try using a different GRID ID to see how results change, e.g. by <a class="reference external" href="https://grid.ac/institutes">browsing for another GRID organization</a>.</p>
</div></blockquote>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">GRIDID</span> <span class="o">=</span> <span class="s2">&quot;grid.412125.1&quot;</span> <span class="c1">#@param {type:&quot;string&quot;}</span>

<span class="c1">#@markdown The start/end year of publications used to extract patents</span>
<span class="n">YEAR_START</span> <span class="o">=</span> <span class="mi">2000</span> <span class="c1">#@param {type: &quot;slider&quot;, min: 1950, max: 2020}</span>
<span class="n">YEAR_END</span> <span class="o">=</span> <span class="mi">2016</span> <span class="c1">#@param {type: &quot;slider&quot;, min: 1950, max: 2020}</span>

<span class="c1">#@markdown ---</span>
<span class="c1">#@markdown A keyword used to filter publications search</span>
<span class="n">TOPIC</span> <span class="o">=</span> <span class="s2">&quot;nanotechnology&quot;</span> <span class="c1">#@param {type:&quot;string&quot;}</span>

<span class="k">if</span> <span class="n">YEAR_END</span> <span class="o">&lt;</span> <span class="n">YEAR_START</span><span class="p">:</span>
  <span class="n">YEAR_END</span> <span class="o">=</span> <span class="n">YEAR_START</span>

<span class="c1">#</span>
<span class="c1"># gen link to Dimensions</span>
<span class="c1">#</span>
<span class="k">try</span><span class="p">:</span>
  <span class="n">gridname</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&quot;&quot;search organizations where id=&quot;</span><span class="si">{</span><span class="n">GRIDID</span><span class="si">}</span><span class="s2">&quot; return organizations[name]&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">organizations</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
  <span class="n">gridname</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;GRID: &lt;a href=&quot;</span><span class="si">{}</span><span class="s1">&quot; title=&quot;View selected organization in Dimensions&quot;&gt;</span><span class="si">{}</span><span class="s1"> - </span><span class="si">{}</span><span class="s1"> &amp;#x29c9;&lt;/a&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dimensions_url</span><span class="p">(</span><span class="n">GRIDID</span><span class="p">),</span> <span class="n">GRIDID</span><span class="p">,</span> <span class="n">gridname</span><span class="p">)))</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;Time period: </span><span class="si">{}</span><span class="s1"> to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">YEAR_START</span><span class="p">,</span> <span class="n">YEAR_END</span><span class="p">)))</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s1">&#39;Topic: &quot;</span><span class="si">{}</span><span class="s1">&quot; &lt;br /&gt;&lt;br /&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TOPIC</span><span class="p">)))</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
GRID: <a href="None" title="View selected organization in Dimensions">grid.412125.1 - King Abdulaziz University &#x29c9;</a></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
Time period: 2000 to 2016</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
Topic: "nanotechnology" <br /><br /></div>
</div>
</div>
<div class="section" id="2.-Building-a-one-degree-network-of-collaborating-institutions">
<h2>2. Building a one-degree network of collaborating institutions<a class="headerlink" href="#2.-Building-a-one-degree-network-of-collaborating-institutions" title="Permalink to this headline">¶</a></h2>
<p>We can use the <a class="reference external" href="https://docs.dimensions.ai/dsl/data-sources.html#publications">publications API</a> to find the top 10 collaborating institutions based on the parameters above, via a single query.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_collaborators</span></code> function below fills out a templated query with the relevant bits and runs it. Then it transforms the results into a pandas dataframe, which will make it easier to process the data later on.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">query_template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;search publications </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">                   where year in [</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">]</span>
<span class="s2">                   and research_orgs.id=&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="s2">                return research_orgs limit 11&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">get_collaborators</span><span class="p">(</span><span class="n">orgid</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">printquery</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">TOPIC</span><span class="p">:</span>
        <span class="n">TOPIC_CLAUSE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;for &quot;</span><span class="si">{</span><span class="n">TOPIC</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">TOPIC_CLAUSE</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># fill in the blanks in the query_template</span>
    <span class="n">query_full</span> <span class="o">=</span> <span class="n">query_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TOPIC_CLAUSE</span><span class="p">,</span> <span class="n">YEAR_START</span><span class="p">,</span> <span class="n">YEAR_END</span><span class="p">,</span> <span class="n">orgid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">printquery</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">query_full</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_full</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
    <span class="c1"># add extra columns</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;id_from&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">orgid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
<p>Note:</p>
<ul class="simple">
<li><p><strong>Extra columns</strong>. The resulting dataframe contains two extra columns: a) <code class="docutils literal notranslate"><span class="pre">id_from</span></code>, which is the ‘seed’ institution we start from; b) <code class="docutils literal notranslate"><span class="pre">level</span></code>, an optional parameter representing the network depth of the query (we’ll see later how it is used with recursive querying).</p></li>
<li><p><strong>Self-collaboration</strong>. The query returns 11 records - that’s because the first one is normally the seed GRID (due to internal collaborations) which we will omit from the results.</p></li>
<li><p><strong>Custom changes</strong>. Lastly, it’s important to remember that this step can be easily customised by changing the <code class="docutils literal notranslate"><span class="pre">query_template</span></code> sttructure. For example, we could focus on specific research areas (using FOR codes), or set a threshold based on citation counts. The possibilities are endless!</p></li>
</ul>
<p>For example, let’s try it out with our GRID ID:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">get_collaborators</span><span class="p">(</span><span class="n">GRIDID</span><span class="p">,</span> <span class="n">printquery</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
search publications for &#34;nanotechnology&#34;
                   where year in [2000:2016]
                   and research_orgs.id=&#34;grid.412125.1&#34;
                return research_orgs limit 11
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>acronym</th>
      <th>city_name</th>
      <th>count</th>
      <th>country_name</th>
      <th>id</th>
      <th>latitude</th>
      <th>linkout</th>
      <th>longitude</th>
      <th>name</th>
      <th>types</th>
      <th>state_name</th>
      <th>id_from</th>
      <th>level</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>KAU</td>
      <td>Jeddah</td>
      <td>1400</td>
      <td>Saudi Arabia</td>
      <td>grid.412125.1</td>
      <td>21.493889</td>
      <td>[http://www.kau.edu.sa/home_english.aspx]</td>
      <td>39.250280</td>
      <td>King Abdulaziz University</td>
      <td>[Education]</td>
      <td>NaN</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>Cambridge</td>
      <td>99</td>
      <td>United States</td>
      <td>grid.38142.3c</td>
      <td>42.377052</td>
      <td>[http://www.harvard.edu/]</td>
      <td>-71.116650</td>
      <td>Harvard University</td>
      <td>[Education]</td>
      <td>Massachusetts</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NU</td>
      <td>Boston</td>
      <td>95</td>
      <td>United States</td>
      <td>grid.261112.7</td>
      <td>42.339830</td>
      <td>[http://www.northeastern.edu/]</td>
      <td>-71.089180</td>
      <td>Northeastern University</td>
      <td>[Education]</td>
      <td>Massachusetts</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>MIT</td>
      <td>Cambridge</td>
      <td>70</td>
      <td>United States</td>
      <td>grid.116068.8</td>
      <td>42.359820</td>
      <td>[http://web.mit.edu/]</td>
      <td>-71.092110</td>
      <td>Massachusetts Institute of Technology</td>
      <td>[Education]</td>
      <td>Massachusetts</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>HST</td>
      <td>Cambridge</td>
      <td>59</td>
      <td>United States</td>
      <td>grid.413735.7</td>
      <td>42.361780</td>
      <td>[http://hst.mit.edu/]</td>
      <td>-71.086914</td>
      <td>Harvard–MIT Division of Health Sciences and Te...</td>
      <td>[Education]</td>
      <td>Massachusetts</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NU</td>
      <td>Evanston</td>
      <td>49</td>
      <td>United States</td>
      <td>grid.16753.36</td>
      <td>42.054850</td>
      <td>[http://www.northwestern.edu/]</td>
      <td>-87.673940</td>
      <td>Northwestern University</td>
      <td>[Education]</td>
      <td>Illinois</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6</th>
      <td>QAU</td>
      <td>Islamabad</td>
      <td>46</td>
      <td>Pakistan</td>
      <td>grid.412621.2</td>
      <td>33.747223</td>
      <td>[http://www.qau.edu.pk/]</td>
      <td>73.138885</td>
      <td>Quaid-i-Azam University</td>
      <td>[Education]</td>
      <td>NaN</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AMU</td>
      <td>Aligarh</td>
      <td>45</td>
      <td>India</td>
      <td>grid.411340.3</td>
      <td>27.917370</td>
      <td>[http://www.amu.ac.in/]</td>
      <td>78.077850</td>
      <td>Aligarh Muslim University</td>
      <td>[Education]</td>
      <td>Uttar Pradesh</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>8</th>
      <td>KSU</td>
      <td>Riyadh</td>
      <td>39</td>
      <td>Saudi Arabia</td>
      <td>grid.56302.32</td>
      <td>24.723982</td>
      <td>[http://ksu.edu.sa/en/]</td>
      <td>46.645840</td>
      <td>King Saud University</td>
      <td>[Education]</td>
      <td>NaN</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>9</th>
      <td>BWH</td>
      <td>Boston</td>
      <td>39</td>
      <td>United States</td>
      <td>grid.62560.37</td>
      <td>42.335600</td>
      <td>[http://www.brighamandwomens.org/]</td>
      <td>-71.106415</td>
      <td>Brigham and Women's Hospital</td>
      <td>[Healthcare]</td>
      <td>Massachusetts</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>10</th>
      <td>NaN</td>
      <td>Ismailia</td>
      <td>37</td>
      <td>Egypt</td>
      <td>grid.33003.33</td>
      <td>30.622778</td>
      <td>[http://scuegypt.edu.eg/ar/]</td>
      <td>32.275000</td>
      <td>Suez Canal University</td>
      <td>[Education]</td>
      <td>NaN</td>
      <td>grid.412125.1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="3.-Building-a-network-of-any-size">
<h2>3. Building a network of any size<a class="headerlink" href="#3.-Building-a-network-of-any-size" title="Permalink to this headline">¶</a></h2>
<p>What if we want to retrieve the collaborators of the collaborators? In other words, what if we want to generate a larger network?</p>
<p>If we think of our collaboration data as a <a class="reference external" href="https://en.wikipedia.org/wiki/Graph_(discrete_mathematics)">graph structure</a> with nodes and edges, we can see that the <code class="docutils literal notranslate"><span class="pre">get_collaborators</span></code> function defined above is limited. That’s because it allows to obtain only the objects <em>directly</em> linked to the ‘seed’ GRID organization.</p>
<p>We would like to run the same collaborators-extraction step <strong>iteratively</strong> for any GRID ID in our results, so to generate an N-degrees network where N is chosen by us.</p>
<p>To this purpose, we can set up a <a class="reference external" href="https://en.wikipedia.org/wiki/Recursion_(computer_science)">recursive</a> function. This function essentially repeats the <code class="docutils literal notranslate"><span class="pre">get_collaborators</span></code> function as many times as needed. Here’s what it looks like:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recursive_network</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">maxlevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">thislevel</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="s2">&quot;Recursive function for building an organization collaboration network&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">get_collaborators</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="n">thislevel</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--&quot;</span> <span class="o">*</span> <span class="n">thislevel</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="s2">&quot; :: level =&quot;</span><span class="p">,</span> <span class="n">thislevel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">thislevel</span> <span class="o">&lt;</span> <span class="n">maxlevel</span><span class="p">:</span>
        <span class="c1"># remove the originating grid-id</span>
        <span class="n">gridslist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">GRIDID</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">next_level_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">recursive_network</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">maxlevel</span><span class="p">,</span> <span class="n">thislevel</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">gridslist</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_level_results</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># finally</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
<p>A few key points to note:</p>
<ul class="simple">
<li><p><strong>Recursion depth</strong>. The <code class="docutils literal notranslate"><span class="pre">maxlevel</span></code> parameter determines how big our network should be (1 = neighbours only, 2 = collaborators of neighbours,e tc..)</p></li>
<li><p><strong>API quota</strong>. We pause 1 second after each iteration to avoid hitting the normal Analytics API quota (~30 requests per minute)</p></li>
<li><p><strong>Data size</strong>. The function can generate lots of data! E.g. calling this function with <code class="docutils literal notranslate"><span class="pre">maxlevel=5</span></code> will lead to 10k queries! (note: you can get a rough estimate of the queries via the formula <em>10 to the power of maxlevel-1</em>. That’s because 10 is the number of orgs we extract per iteration, and maxlevel is the number or iterations, minus the first one which generates no extra queries).</p></li>
</ul>
<p>Let’s try this out.</p>
<p>We can construct a 2-degrees collaboration network starting from King Abdulaziz University. We are extracting 10 organizations per node so our network will have ~100 nodes at the end!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collaborators</span> <span class="o">=</span> <span class="n">recursive_network</span><span class="p">(</span><span class="n">GRIDID</span><span class="p">,</span> <span class="n">maxlevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># change column order for readability purposes</span>
<span class="n">collaborators</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;id_to&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">collaborators</span> <span class="o">=</span> <span class="n">collaborators</span><span class="p">[[</span><span class="s1">&#39;id_from&#39;</span><span class="p">,</span> <span class="s1">&#39;id_to&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;acronym&#39;</span><span class="p">,</span> <span class="s1">&#39;city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;state_name&#39;</span><span class="p">,</span> <span class="s1">&#39;country_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;linkout&#39;</span><span class="p">,</span>  <span class="s1">&#39;types&#39;</span> <span class="p">]]</span>
<span class="n">collaborators</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-- grid.412125.1  :: level = 1
---- grid.38142.3c  :: level = 2
---- grid.261112.7  :: level = 2
---- grid.116068.8  :: level = 2
---- grid.413735.7  :: level = 2
---- grid.16753.36  :: level = 2
---- grid.412621.2  :: level = 2
---- grid.411340.3  :: level = 2
---- grid.56302.32  :: level = 2
---- grid.62560.37  :: level = 2
---- grid.33003.33  :: level = 2
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id_from</th>
      <th>id_to</th>
      <th>level</th>
      <th>count</th>
      <th>name</th>
      <th>acronym</th>
      <th>city_name</th>
      <th>state_name</th>
      <th>country_name</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>linkout</th>
      <th>types</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>grid.412125.1</td>
      <td>grid.412125.1</td>
      <td>1</td>
      <td>1400</td>
      <td>King Abdulaziz University</td>
      <td>KAU</td>
      <td>Jeddah</td>
      <td>NaN</td>
      <td>Saudi Arabia</td>
      <td>21.493889</td>
      <td>39.250280</td>
      <td>[http://www.kau.edu.sa/home_english.aspx]</td>
      <td>[Education]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>grid.412125.1</td>
      <td>grid.38142.3c</td>
      <td>1</td>
      <td>99</td>
      <td>Harvard University</td>
      <td>NaN</td>
      <td>Cambridge</td>
      <td>Massachusetts</td>
      <td>United States</td>
      <td>42.377052</td>
      <td>-71.116650</td>
      <td>[http://www.harvard.edu/]</td>
      <td>[Education]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>grid.412125.1</td>
      <td>grid.261112.7</td>
      <td>1</td>
      <td>95</td>
      <td>Northeastern University</td>
      <td>NU</td>
      <td>Boston</td>
      <td>Massachusetts</td>
      <td>United States</td>
      <td>42.339830</td>
      <td>-71.089180</td>
      <td>[http://www.northeastern.edu/]</td>
      <td>[Education]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>grid.412125.1</td>
      <td>grid.116068.8</td>
      <td>1</td>
      <td>70</td>
      <td>Massachusetts Institute of Technology</td>
      <td>MIT</td>
      <td>Cambridge</td>
      <td>Massachusetts</td>
      <td>United States</td>
      <td>42.359820</td>
      <td>-71.092110</td>
      <td>[http://web.mit.edu/]</td>
      <td>[Education]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>grid.412125.1</td>
      <td>grid.413735.7</td>
      <td>1</td>
      <td>59</td>
      <td>Harvard–MIT Division of Health Sciences and Te...</td>
      <td>HST</td>
      <td>Cambridge</td>
      <td>Massachusetts</td>
      <td>United States</td>
      <td>42.361780</td>
      <td>-71.086914</td>
      <td>[http://hst.mit.edu/]</td>
      <td>[Education]</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="4.-Visualizing-the-network">
<h2>4. Visualizing the network<a class="headerlink" href="#4.-Visualizing-the-network" title="Permalink to this headline">¶</a></h2>
<p>In order to get an overview of the network data we can visualize it using the Python <a class="reference external" href="https://pyvis.readthedocs.io/en/latest/tutorial.html">pyvis</a> library. A custom version of pyvis is already included in <a class="reference external" href="https://github.com/digital-science/dimcli/blob/master/dimcli/core/extras.py">dimcli.core.extras</a> and is called <code class="docutils literal notranslate"><span class="pre">NetworkViz</span></code> (note: this custom version only fixes a bug that prevents pyvis graphs to be displayed online with Google Colab).</p>
<p>Network visualizations can be very complex, but to begin with we can focus on representing two key aspects:</p>
<ul class="simple">
<li><p><strong>Core collaborators</strong>. The size of the nodes should be proportional to the proximity to our ‘seed’ organization. This will make it easier to quickly identify the key players in the network</p></li>
<li><p><strong>Number of publications</strong>. The strenght of the collaboration should be proportional to the size of the edges (= how many publications two orgs have in common)</p></li>
</ul>
<p>In a nutshell, this is what the code below does:</p>
<ul class="simple">
<li><p>After creating a <code class="docutils literal notranslate"><span class="pre">NetworkViz</span></code> object, we add nodes and edges from our dataset using the <code class="docutils literal notranslate"><span class="pre">add_node</span></code> and <code class="docutils literal notranslate"><span class="pre">add_edge</span></code> method.</p></li>
<li><p>The Network <code class="docutils literal notranslate"><span class="pre">repulsion</span></code> parameter is set to 300, but for bigger charts you may want to increase that.</p></li>
<li><p>Nodes and edges in pyvis can have a number of attributes. The full list of attributes can be found in the <a class="reference external" href="https://pyvis.readthedocs.io/en/latest/tutorial.html">pyvis documentation</a>.</p></li>
<li><p>In order to have some nice colors, we take advantage of the built-in <a class="reference external" href="https://plot.ly/python/builtin-colorscales/">plotly color scales</a>. Try changing them!</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load custom version of pyvis</span>
<span class="kn">from</span> <span class="nn">dimcli.utils.networkviz</span> <span class="kn">import</span> <span class="n">NetworkViz</span>


<span class="k">def</span> <span class="nf">build_visualization</span><span class="p">(</span><span class="n">collaborator_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a network visualization object from a collaborators dataframe</span>
<span class="sd">    The object can be then displayed/saved with `g.show(f&quot;network.html&quot;)`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># set up dataviz</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">NetworkViz</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;800px&quot;</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">toggle_hide_edges_on_drag</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">barnes_hut</span><span class="p">()</span>
    <span class="n">g</span><span class="o">.</span><span class="n">repulsion</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">g</span><span class="o">.</span><span class="n">heading</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Collaboration network for &#39;</span><span class="si">{</span><span class="n">GRIDID</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">gridname</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="c1"># reuse plotly color palette</span>
    <span class="n">palette</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">diverging</span><span class="o">.</span><span class="n">Temps</span>
    <span class="c1"># g.show_buttons() # in html-standalone mode, this command shows viz controls</span>


    <span class="c1">#</span>
    <span class="c1"># create nodes and edges</span>
    <span class="c1">#</span>

    <span class="c1"># remove duplicates from nodes</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">collaborator_df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span><span class="s2">&quot;id_to&quot;</span><span class="p">,</span> <span class="n">keep</span> <span class="o">=</span> <span class="s1">&#39;first&#39;</span><span class="p">)</span>
    <span class="c1"># remove internal collaborations stats</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">collaborator_df</span><span class="p">[(</span><span class="n">collaborator_df</span><span class="p">[</span><span class="s1">&#39;id_to&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">collaborator_df</span><span class="p">[</span><span class="s1">&#39;id_from&#39;</span><span class="p">])]</span>


    <span class="c1">#</span>
    <span class="c1"># add nodes</span>
    <span class="c1">#</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

        <span class="c1"># calc size based on level</span>
        <span class="n">maxsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id_to&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">maxsize</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">maxsize</span> <span class="o">-</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span>

        <span class="c1"># calc color based on level</span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id_to&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GRIDID</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">palette</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">]</span>

        <span class="n">g</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span>
            <span class="n">n_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id_to&#39;</span><span class="p">],</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&lt;h4&gt;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;city_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;country_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;br&gt; - </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id_to&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/h4&gt;&quot;</span><span class="p">,</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">,</span>
            <span class="n">borderWidthSelected</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="s2">&quot;dot&quot;</span><span class="p">,</span>
        <span class="p">)</span>


    <span class="c1">#</span>
    <span class="c1"># add edges</span>
    <span class="c1">#</span>

    <span class="n">edges_maxcount</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">edges</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
      <span class="n">g</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id_from&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id_to&#39;</span><span class="p">],</span>
                 <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span> <span class="o">/</span> <span class="n">edges_maxcount</span><span class="p">,</span>
                 <span class="n">label</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]),</span>
                 <span class="n">arrows</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
                <span class="p">)</span>

    <span class="c1"># add tooltips with adjancent links info</span>
    <span class="n">neighbor_map</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_adj_list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="n">neigh</span> <span class="o">=</span> <span class="n">neighbor_map</span><span class="p">[</span><span class="n">node</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;id_to&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">neigh</span><span class="p">]</span>
        <span class="n">node</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="s2">&quot;Links:&lt;li&gt;&quot;</span> <span class="o">+</span> <span class="s2">&quot;&lt;/li&gt;&lt;li&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">g</span>

<span class="c1">#</span>
<span class="c1"># finall, run the viz builder</span>
<span class="c1">#</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">build_visualization</span><span class="p">(</span><span class="n">collaborators</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;network_</span><span class="si">{</span><span class="n">GRIDID</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<iframe
    width="100%"
    height="800px"
    src="network_grid.412125.1.html"
    frameborder="0"
    allowfullscreen

></iframe></div>
</div>
</div>
<div class="section" id="5.-Addendum:-showing-only-‘Government’-collaborators">
<h2>5. Addendum: showing only ‘Government’ collaborators<a class="headerlink" href="#5.-Addendum:-showing-only-‘Government’-collaborators" title="Permalink to this headline">¶</a></h2>
<p>What if we want to show a collaboration network focusing only on ‘government’ organizations?</p>
<p>That’s pretty easy to do, since the GRID database includes information about <strong>organization types</strong>. We can easily see what types are available using the API and a <code class="docutils literal notranslate"><span class="pre">facet</span></code> query:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">dsldf</span> search organizations return types
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Returned Types: 10
Time: 0.59s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>30088</td>
      <td>Company</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20326</td>
      <td>Education</td>
    </tr>
    <tr>
      <th>2</th>
      <td>13903</td>
      <td>Nonprofit</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13258</td>
      <td>Healthcare</td>
    </tr>
    <tr>
      <th>4</th>
      <td>9554</td>
      <td>Facility</td>
    </tr>
    <tr>
      <th>5</th>
      <td>8267</td>
      <td>Other</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6187</td>
      <td>Government</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2843</td>
      <td>Archive</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1</td>
      <td>Education,Company</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1</td>
      <td>Education,Nonprofit</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The steps are the following:</p>
<ul class="simple">
<li><p><strong>New query filter</strong>. We rewrite the <code class="docutils literal notranslate"><span class="pre">get_collaborators</span></code> function we created in section 2 above, so that the API query includes a filter for organizations with the selected type only: <code class="docutils literal notranslate"><span class="pre">..</span> <span class="pre">and</span> <span class="pre">research_orgs.types</span> <span class="pre">in</span> <span class="pre">[&quot;Government&quot;]...</span></code></p></li>
<li><p><strong>Get more results</strong>. We increase the number of results returned: <code class="docutils literal notranslate"><span class="pre">..return</span> <span class="pre">research_orgs</span> <span class="pre">limit</span> <span class="pre">50</span></code>. This is to ensure we still have enough results after removing the ones that don’t have the chosen ‘type’</p></li>
<li><p><strong>Remove unwanted data</strong>. The new query filter <code class="docutils literal notranslate"><span class="pre">research_orgs.types</span> <span class="pre">in</span> <span class="pre">[&quot;{}&quot;]</span></code> will return also publications with multiple authors/affiliations, even though only one of them has the desired ‘type’. So an extra step is required and this is achieved via the <code class="docutils literal notranslate"><span class="pre">keep_type</span></code> function below. This function simply filters out all unwanted organizations data after they’re retrieved from the API.</p></li>
</ul>
<p>That’s it! Run the cell below to generate a new visualization showing only “Government” collaborators. Or try changing the value of <code class="docutils literal notranslate"><span class="pre">GRID_TYPE</span></code> to see different results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#@markdown Try using one of the organization types from the list above</span>

<span class="n">GRID_TYPE</span> <span class="o">=</span> <span class="s2">&quot;Government&quot;</span> <span class="c1">#@param {type:&quot;string&quot;}</span>

<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;search publications </span><span class="si">{}</span><span class="s2"></span>
<span class="s2">               where year in [</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">]</span>
<span class="s2">               and research_orgs.id=&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>
<span class="s2">               and research_orgs.types in [&quot;</span><span class="si">{}</span><span class="s2">&quot;]</span>
<span class="s2">            return research_orgs limit 50&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">keep_only_type</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">a_type</span><span class="p">,</span> <span class="n">orgid</span><span class="p">):</span>
    <span class="n">clean_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">research_orgs</span><span class="p">:</span>
        <span class="c1"># include also originating GRID to ensure chart is complete</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">orgid</span> <span class="ow">or</span> <span class="n">a_type</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;types&#39;</span><span class="p">]:</span>
            <span class="n">clean_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;research_orgs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_list</span>
    <span class="k">return</span> <span class="n">data</span>


<span class="k">def</span> <span class="nf">get_collaborators</span><span class="p">(</span><span class="n">orgid</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">printquery</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="s2">&quot;New version that filters using org types as well&quot;</span>
    <span class="k">if</span> <span class="n">TOPIC</span><span class="p">:</span>
        <span class="n">TOPIC_CLAUSE</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;for &quot;</span><span class="si">{</span><span class="n">TOPIC</span><span class="si">}</span><span class="s2">&quot; &quot;&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">TOPIC_CLAUSE</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="c1"># include also the GRID_TYPE</span>
    <span class="n">query_full</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TOPIC_CLAUSE</span><span class="p">,</span> <span class="n">YEAR_START</span><span class="p">,</span> <span class="n">YEAR_END</span><span class="p">,</span> <span class="n">orgid</span><span class="p">,</span> <span class="n">GRID_TYPE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">printquery</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">query_full</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">dsl</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_full</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># remove results with unwanted types</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">keep_only_type</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;Government&quot;</span><span class="p">,</span> <span class="n">orgid</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">as_dataframe</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;id_from&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">orgid</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">level</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="c1">#</span>
<span class="c1"># RUN THE RECURSIVE QUERY (same code as above)</span>
<span class="c1">#</span>
<span class="n">collaborators</span> <span class="o">=</span> <span class="n">recursive_network</span><span class="p">(</span><span class="n">GRIDID</span><span class="p">,</span> <span class="n">maxlevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">collaborators</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;id_to&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">collaborators</span> <span class="o">=</span> <span class="n">collaborators</span><span class="p">[[</span><span class="s1">&#39;id_from&#39;</span><span class="p">,</span> <span class="s1">&#39;id_to&#39;</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;acronym&#39;</span><span class="p">,</span> <span class="s1">&#39;city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;country_name&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;linkout&#39;</span><span class="p">,</span>  <span class="s1">&#39;types&#39;</span> <span class="p">]]</span>

<span class="c1">#</span>
<span class="c1"># BUILD VIZ</span>
<span class="c1">#</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">build_visualization</span><span class="p">(</span><span class="n">collaborators</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;network_</span><span class="si">{</span><span class="n">GRIDID</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">GRID_TYPE</span><span class="si">}</span><span class="s2">.html&quot;</span><span class="p">)</span>
<br/><br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-- grid.412125.1  :: level = 1
---- grid.9227.e  :: level = 2
---- grid.20256.33  :: level = 2
---- grid.418524.e  :: level = 2
---- grid.418654.a  :: level = 2
---- grid.7327.1  :: level = 2
---- grid.1089.0  :: level = 2
---- grid.14467.30  :: level = 2
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<iframe
    width="100%"
    height="800px"
    src="network_grid.412125.1_Government.html"
    frameborder="0"
    allowfullscreen

></iframe></div>
</div>
</div>
<div class="section" id="Conclusions">
<h2>Conclusions<a class="headerlink" href="#Conclusions" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial we have demonstrated how to generate an organization ‘collaborations network diagram’ using the Dimensions API. Starting from a research organization, we extracted information about other collaborating organizations, based on shared publications data, a topic and a time-frame.</p>
<p>An example of the resulting network diagram <a class="reference external" href="http://api-sample-data.dimensions.ai/dataviz-exports/3-Organizations-Collaboration-Network/network_2_levels_grid.412125.1.html">can be seen here</a>.</p>
<p>Here’s some ideas for further experimentation:</p>
<ul class="simple">
<li><p>try changing the initial <code class="docutils literal notranslate"><span class="pre">publications</span></code> query so to include other parameters. The <a class="reference external" href="https://docs.dimensions.ai/dsl/data-sources.html#publications">publications API</a> is rich so there’re many ways to fine-tune your analysis</p></li>
<li><p>try increasing the number of iterations using the <code class="docutils literal notranslate"><span class="pre">maxlevel</span></code> parameter</p></li>
<li><p>try customizing the resulting network diagram, e.g. to highlight nodes and edges based on different criteria like countries or years.</p></li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference external" href="https://www.dimensions.ai/dimensions-apis/">Dimensions Analytics API</a> allows to carry out sophisticated research data analytics tasks like the ones described on this website. Check out also the associated <a class="reference external" href="https://github.com/digital-science/dimensions-api-lab">Github repository</a> for examples, the source code of these tutorials and much more.</p>
</div>
<a class="reference external image-reference" href="https://www.dimensions.ai/dimensions-apis/"><img alt="../_images/badge-dimensions-api.svg" src="../_images/badge-dimensions-api.svg" /></a>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
    <p>© Copyright 2020 Digital Science & Research Solutions, Inc. All Rights Reserved | <a href="https://www.dimensions.ai/">About us</a> · <a href="https://www.dimensions.ai/privacy/">Privacy policy</a> · <a href="https://www.dimensions.ai/website-terms/">Legal terms</a></p>
     

    <!-- OneTrust Cookies Settings button start -->
    <button id="ot-sdk-btn" class="ot-sdk-show-settings">Cookie Settings</button>
    <!-- OneTrust Cookies Settings button end -->



</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    

    <!-- Adds target=_blank to external links -->

  <script type="text/javascript">
    $(document).ready(function () {
      $('a[href^="http://"], a[href^="https://"]').not('a[class*=internal]').attr('target', '_blank');
    });
  </script>


  <!-- OneTrust Cookies Consent Notice start for dimensions.ai -->
   <script type="text/javascript" src="https://cdn.cookielaw.org/consent/3329b668-7887-4dba-9bee-c3853a706e6f/OtAutoBlock.js" ></script>
   <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="3329b668-7887-4dba-9bee-c3853a706e6f" ></script>
   <script type="text/javascript">
   function OptanonWrapper() { }
   </script>
   <!-- OneTrust Cookies Consent Notice end for dimensions.ai -->
  


</body>
</html>